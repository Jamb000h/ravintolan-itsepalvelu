{% extends "layout.html" %}
{% block title %}Your orders and tables{% endblock %}
{% block content %}
<h1>{{ session.username }}</h1>

<h2>New orders, oldest on top</h2>

<ul>
    {% for order in orders if order[2] == 'new' %}
    <li>
        {{ order[4] }} at {{ order[1] }}<br />
        <form action="/cancelorder" method="POST">
            <input type="hidden" name="csrfToken" value="{{ session.csrfToken }}">
            <input name="orderId" type="hidden" value="{{ order[0] }}" />
            <input type="submit" value="Cancel order" />
        </form>
        <form action="/proceedorder" method="POST">
            <input type="hidden" name="csrfToken" value="{{ session.csrfToken }}">
            <input name="orderId" type="hidden" value="{{ order[0] }}" />
            <input type="submit" value="Accept order" />
        </form>
        {% for orderItem in orderItems %}
        {% if orderItem[0] == order[0] %}
    <li>{{ orderItem[2] }} á {{ orderItem[3] }} €<br />x {{ orderItem[1] }} = {{ orderItem[1] * orderItem[3] |
        round(2)}}</li>
    {% endif %}
    {% endfor %}
    Order total: <span class="total">{{ orderTotals[order[0]] | round(2) }} €</span>
    </li>
    {% endfor %}
</ul>

<h2>Orders in progress, oldest on top</h2>

<ul>
    {% for order in orders if order[2] == 'inprogress' %}
    <li>
        {{ order[4] }} accepted at {{ order[5] }}</span><br />
        <form action="/proceedorder" method="POST">
            <input type="hidden" name="csrfToken" value="{{ session.csrfToken }}">
            <input name="orderId" type="hidden" value="{{ order[0] }}" />
            <input type="submit" value="Complete order" />
        </form>
        {% for orderItem in orderItems %}
        {% if orderItem[0] == order[0] %}
    <li>{{ orderItem[2] }} á {{ orderItem[3] }} €<br />x {{ orderItem[1] }} = {{ orderItem[1] * orderItem[3] |
        round(2)}}</li>
    {% endif %}
    {% endfor %}
    Order total: <span class="total">{{ orderTotals[order[0]] | round(2) }} €</span>
    </li>
    {% endfor %}
</ul>

<h2>Completed orders</h2>

<ul>
    {% for order in orders if order[2] == 'completed' %}
    <li>
        {{ order[4] }} completed at {{ order[5] }}<br />
        {% for orderItem in orderItems %}
        {% if orderItem[0] == order[0] %}
    <li>{{ orderItem[2] }} á {{ orderItem[3] }} €<br />x {{ orderItem[1] }} = {{ orderItem[1] * orderItem[3] |
        round(2)}}</li>
    {% endif %}
    {% endfor %}
    Order total: <span class="total">{{ orderTotals[order[0]] | round(2) }} €</span>
    </li>
    {% endfor %}
</ul>

<h2>Your tables</h2>

<ul>
    {% for table in tables %}
    <li>
        {{ table[1] }}
        {% if table[2] == True %}
        <form action="/haspaid" method="POST">
            <input type="hidden" name="csrfToken" value="{{ session.csrfToken }}">
            <input name="tableId" type="hidden" value="{{ table[0] }}" />
            <input type="submit" value="Mark bill as paid" />
        </form>
        {% endif %}
    </li>
    {% endfor %}
</ul>

{% endblock %}